apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: ambassador-dev
  namespace: dev
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: ambassador-dev
  chart:
    git: git@github.com:helm/charts
    path: stable/ambassador
    ref: master
  values:
    service:
      enableHttp: true 
      enableHttps: true 
    
      targetPorts:
        http: 80
        https: 80
    
      httpPort: 80
      httpsPort: 443 
    
      annotations:
        getambassador.io/config: |
          --- 
          apiVersion: ambassador/v1
          kind:  Module
          name:  ambassador
          config:
            use_proxy_proto: false
            use_remote_address: false
            x_forwarded_proto_redirect: true
            cors:
              origins: "*"
              methods: "GET, POST, PUT, PATCH, DELETE"
              headers:  "authorization, content-type, x-tidepool-session-token, x-tidepool-trace-request, x-tidepool-trace-session"
              credentials: true
              exposed_headers: "x-tidepool-session-token, x-tidepool-trace-request, x-tidepool-trace-session"
              max_age: "0"
