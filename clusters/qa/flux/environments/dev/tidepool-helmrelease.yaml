---
apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: tidepool
  namespace: dev
  annotations:
    flux.weave.works/automated: "true"
    #flux.weave.works/tag.shoreline: "regexp:^v\d+\.\d+\.\d+$"
    #flux.weave.works/tag.shoreline: "semver:~1."
    #flux.weave.works/tag.shoreline: "glob:master-*"
    flux.weave.works/tag.auth: glob:quiet-*
    flux.weave.works/tag.blip: glob:release-1.23.0*
    flux.weave.works/tag.blob: glob:quiet-*
    flux.weave.works/tag.data: glob:develop-*
    flux.weave.works/tag.export: glob:develop-*
    flux.weave.works/tag.gatekeeper: glob:mongo-*
    flux.weave.works/tag.highwater: glob:quiet-*
    flux.weave.works/tag.hydrophone: glob:mongo-*
    flux.weave.works/tag.image: glob:quiet-*
    flux.weave.works/tag.jellyfish: glob:mongo-*
    flux.weave.works/tag.messageapi: glob:mongo-*
    flux.weave.works/tag.migrations: glob:quiet-*
    flux.weave.works/tag.notification: glob:quiet-*
    flux.weave.works/tag.seagull: glob:mongo-*
    flux.weave.works/tag.shoreline: glob:mongo-*
    flux.weave.works/tag.task: glob:quiet-*
    flux.weave.works/tag.tidewhisperer: glob:mongo-*
    flux.weave.works/tag.tools: glob:quiet-*
    flux.weave.works/tag.user: glob:quiet-*
spec:
  releaseName: dev-tidepool
  chart:
    git: git@github.com:tidepool-org/development
    path: charts/tidepool/0.1.5
    ref: k8s
  values:
    gloo:
      enabled: false
    global:
      secrets:
        internal:
          source: awsSecretsManager
        external:
          source: awsSecretsManager
      hosts:
        default:
          protocol: https
          host: dev.tidepool.org
        http: {}
        https:
          dev:
            name: dev.tidepool.org
            tlssecret:
              name: tidepool-org
              namespace: default
          api:
            name: dev-api.tidepool.org
            tlssecret:
              name: tidepool-org
              namespace: default
          app:
            name: dev-app.tidepool.org
            tlssecret:
              name: tidepool-org
              namespace: default
          uploads:
            name: dev-uploads.tidepool.org
            tlssecret:
              name: tidepool-org
              namespace: default
      gateway:
        name: gloo
      mongo:
        enabled: false
        hosts: "ip-10-48-33-162.us-west-2.compute.internal"
        #hosts: "cluster0-shard-00-00-hu2cn.mongodb.net,cluster0-shard-00-01-hu2cn.mongodb.net,cluster0-shard-00-02-hu2cn.mongodb.net"
        port: 27017
        #username: derrickburns
        ssl: 'true'
        #optParams: 'replicaSet=Cluster0-shard-0&authSource=admin&w=majority'
      namespace:
        create: false
    nosqlclient:
      enabled: false
    blip:
      image: tidepool/blip:release-1.23.0-c6b78f81b4f76a11766e04a88e9082a34e004eaa
    export:
      enabled: true
      image: tidepool/export:develop-b00327cf2a986cf4c63aecc9140c1df63c5caa59
    gatekeeper:
      image: tidepool/gatekeeper:mongo-params-08073174a3ed985a667d85d72d51a5c50a9f37a5
    highwater:
      image: tidepool/highwater:quiet-loggin-8dc36af49754be0b16fa628bebfa6645db3b05b8
    hydrophone:
      image: tidepool/hydrophone:mongo-params-f0d6173ecdc5b059b00c20c5921a552c42a06523
    jellyfish:
      image: tidepool/jellyfish:mongo-params-32a331abeb64b010d53ecbd6454a06fb14dcd6a0
    messageapi:
      image: tidepool/message-api:mongo-params-7d6e64e6b12641ad62a6da434b9be6d2739a541a
    auth:
      image: tidepool/platform-auth:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    blob:
      image: tidepool/platform-blob:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    data:
      image: tidepool/platform-data:develop-8f6f88ace8f5f6852876201b2ba5e0e1ffae3f5f
    image:
      image: tidepool/platform-image:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    migrations:
      image: tidepool/platform-migrations:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    notification:
      enabled: false
      image: tidepool/platform-notification:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    task:
      image: tidepool/platform-task:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    tools:
      enabled: false
      image: tidepool/platform-tools:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    user:
      image: tidepool/platform-user:quiet-logging-d2682daee6fd1ba19af54d713b34b2d621b4d65a
    seagull:
      image: tidepool/seagull:mongo-params-de6b3556e2acf08d5cfef95fec249efeef0bb27b
    shoreline:
      image: tidepool/shoreline:mongo-params-7b567b4a061142a48caeede4e0da1cbcc61fc93c
    tidewhisperer:
      image: tidepool/tide-whisperer:mongo-params-8baa302db33ffcb1d213be22ad82a9945d493835
