---
apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: tidepool
  namespace: dev
  annotations:
    flux.weave.works/automated: "true"
    #flux.weave.works/tag.shoreline: "regexp:^v\d+\.\d+\.\d+$"
    #flux.weave.works/tag.shoreline: "semver:~1."
    #flux.weave.works/tag.shoreline: "glob:master-*"
    flux.weave.works/tag.auth: glob:develop-*
    flux.weave.works/tag.blip: glob:release-1.27.0*
    flux.weave.works/tag.blob: glob:develop-*
    flux.weave.works/tag.data: glob:develop-*
    flux.weave.works/tag.export: glob:develop-*
    flux.weave.works/tag.gatekeeper: glob:develop-*
    flux.weave.works/tag.highwater: glob:develop-*
    flux.weave.works/tag.hydrophone: glob:develop-*
    flux.weave.works/tag.image: glob:develop-*
    flux.weave.works/tag.jellyfish: glob:develop-*
    flux.weave.works/tag.messageapi: glob:develop-*
    flux.weave.works/tag.migrations: glob:develop-*
    flux.weave.works/tag.notification: glob:develop-*
    flux.weave.works/tag.seagull: glob:develop-*
    flux.weave.works/tag.shoreline: glob:develop-*
    flux.weave.works/tag.task: glob:develop-*
    flux.weave.works/tag.tidewhisperer: glob:develop-*
    flux.weave.works/tag.tools: glob:develop-*
    flux.weave.works/tag.user: glob:develop-*
spec:
  releaseName: dev-tidepool
  chart:
    git: git@github.com:tidepool-org/development
    path: charts/tidepool/0.1.5
    ref: k8s
  values:
    gloo:
      enabled: false
    mongodb:
      enabled: false
    global:
      store:
        type: "s3"
      secrets:
        internal:
          source: awsSecretsManager
        external:
          source: awsSecretsManager
      hosts:
        default:
          protocol: https
          host: dev.tidepool.org
        http:
        https:
          dev:
            name: dev.tidepool.org
            tlssecret:
              name: tidepool-org
          api:
            name: dev-api.tidepool.org
            tlssecret:
              name: tidepool-org
          app:
            name: dev-app.tidepool.org
            tlssecret:
              name: tidepool-org
          uploads:
            name: dev-uploads.tidepool.org
            tlssecret:
              name: tidepool-org
      mongo:
        #mongodb+srv://derrickburns:<password>@cluster0-hu2cn.mongodb.net/test?w=majority
        #hosts: "ip-10-48-33-162.us-west-2.compute.internal"
        scheme: 'mongodb'
        hosts: cluster0-shard-00-01-hu2cn.mongodb.net:27017,cluster0-shard-00-00-hu2cn.mongodb.net:27017,cluster0-shard-00-02-hu2cn.mongodb.net:27017
        username: 'derrickburns'
        ssl: 'true'
        optParams: 'replicaSet=Cluster0-shard-0&authSource=admin&w=majority'
      namespace:
        create: false
    blip:
      image: tidepool/blip:release-1.27.0-0346046f985248aea1341577739428ae0408a553
    export:
      enabled: true
      image: tidepool/export:develop-60db12a344f230e2c17e6ec84c8cb166167d7e76
    gatekeeper:
      image: tidepool/gatekeeper:develop-51030b3213d05b739dc4d0d45a0ad7ae06b3b068
    highwater:
      image: tidepool/highwater:develop-5288888159293ec640ac3623191ec395a260eba7
    hydrophone:
      bucket: tidepool-qa1-asset
      image: tidepool/hydrophone:develop-e2c989755666043edefa4d859b74af14b8c8120b
    jellyfish:
      bucket: tidepool-qa1-data
      image: tidepool/jellyfish:develop-33e891e9f666f7608bce9a693fd4c7b2add7537b
    messageapi:
      image: tidepool/message-api:develop-c5ac4c43231c33c2dca7485a88fe27ba64769a06
    auth:
      image: tidepool/platform-auth:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    blob:
      bucket: tidepool-qa1-data
      image: tidepool/platform-blob:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    data:
      image: tidepool/platform-data:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    image:
      bucket: tidepool-qa1-data
      image: tidepool/platform-image:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    migrations:
      image: tidepool/platform-migrations:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    notification:
      enabled: false
      image: tidepool/platform-notification:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    task:
      image: tidepool/platform-task:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    tools:
      enabled: false
      image: tidepool/platform-tools:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    user:
      image: tidepool/platform-user:develop-03cbd1f46006037417749fb3a24031b9f3e2f6cc
    seagull:
      image: tidepool/seagull:develop-3b61d504616e7af2c6e3a0d0a68ad602428b1036
    shoreline:
      image: tidepool/shoreline:develop-67d50c8555969458465b8c1d0aa7c05fd23b8ccf
    tidewhisperer:
      image: tidepool/tide-whisperer:develop-4cb2f869234a0cbb679af33a73be082b04f28a57
