apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: thanos
  namespace: thanos
spec:
  releaseName: thanos
  chart:
    git: git@github.com:arthur-c/thanos-helm-chart
    path: thanos
    ref: master
  values:
    query:
      replicaCount: 1
      logLevel: debug
      queryReplicaLabel: prometheus_replica
      stores:
        - thanos-store-grpc:10901
        - thanos-sidecar-0.monitoring:10901
        - thanos-sidecar-1.monitoring:10901
      tlsClient:
        enabled: false

    deployment:
      annotations: 
        iam.amazonaws.com/role: thanos
    
    objectStorageConfig:
      enabled: true
    
    store:
      tlsServer:
        enabled: false

    query:
      stores:
        thanos-store.thanos:10901
    s3:
      enabled: true
      bucket: "tidepool-thanos"
      endpoint: "s3.us-west-2.amazonaws.com"
      insecure: false
      signatureV2: false
      encryptSse: false
