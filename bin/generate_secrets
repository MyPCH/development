#!/bin/bash -xv
#
# Generate secrets from values file
#

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

if [ $# -ne 1 ]
then 
	echo "Usage: $0 "\${ENVIRONMENT} 
	exit
fi
ENVIRONMENT=$1
TIDEPOOL_CHART=${DEV_REPO:-$DIR/..}/charts/tidepool/0.1.7

if [ ! -d "$TIDEPOOL_CHART" ]
then
	echo "\$DEV_REPO required."
	exit
fi

helm template -f <(cat <&0) --set global.secrets.enabled=true  --namespace $ENVIRONMENT $TIDEPOOL_CHART | extract_secrets

