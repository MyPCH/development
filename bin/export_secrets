#!/bin/bash
#
# Create external secrets in Amazon Secrets Manager
#
# Usage: $0 

if [ -z "$DEV_REPO" ]
then
	echo "\$DEV_REPO required."
	exit
fi

if [ -z "$CLUSTER_NAME" ]
then
	echo "\$CLUSTER_NAME required."
	exit
fi

CHART_DIR=${DEV_REPO}/charts/configurator
TEMPLATE_DIR=${CHART_DIR}/templates

external_secret <(helm template ${CHART_DIR} -x ${TEMPLATE_DIR}/secrets.yaml) create  ${CLUSTER_NAME} encoded >/dev/null
