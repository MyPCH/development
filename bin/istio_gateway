#!/bin/bash

templates="$(helm template $1)"
if [ $? -eq 1 ]
then
	echo "helm template $1" failed
	echo "exiting without writing templates"
	exit 1
fi

echo "$(templates)" | mappings | istio_manifests http  | single_file "# Auto-generated file by $(basename $0). Do not edit.
{{ if and (eq .Values.global.gateway.name \"istio\") (.Values.global.gateway.http.enabled) }}" "{{ end }}"  > $1/templates/istio-http.yaml

echo "$(templates)" | mappings | istio_manifests https | single_file "# Auto-generated file by $(basename $0). Do not edit.
{{ if and (eq .Values.global.gateway.name \"istio\") (.Values.global.gateway.https.enabled) }}" "{{ end }}" > $1/templates/istio-https.yaml

