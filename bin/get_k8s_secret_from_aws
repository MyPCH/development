#!/bin/bash 
#
# Get Secret from AWS Secrets Manager
#
# Usage: $0 $SECRETID

if [ $# -ne 1 ]
then
	echo "Usage: $0 \$SECRETID, e.g. $0 development/qa1/mongo"
	exit 1
fi

yaml=$(aws secretsmanager get-secret-value  --secret-id $1 | jq '.SecretString | fromjson' | yq r - | sed -e 's/^/    /')

cat <<!
apiVersion: v1
kind: Secret
type: Opaque
data:
$yaml
metadata:
  name: ${SECRET}
  namespace: ${ENVIRONMENT}
!
