#!/bin/bash
rm -f $1/templates/gloo-https.yaml $1/templates/gloo-http.yaml

templates="$(helm template --namespace=default $1)"

if [ $? -eq 1 ]
then
	echo "helm template $1" failed
	echo "exiting without writing templates"
	exit 1
fi

echo "$templates" | mappings | gloo_manifests http | single_file "# Auto-generated file by $(basename $0). Do not edit.
{{ if (and (eq .Values.global.gateway.name \"gloo\") (.Values.global.gateway.http.enabled)) }}" "{{ end }}" > $1/templates/gloo-http.yaml

echo "$templates" | mappings | gloo_manifests https | single_file "# Auto-generated file by $(basename $0). Do not edit.
{{ if (and (eq .Values.global.gateway.name \"gloo\") (.Values.global.gateway.https.enabled)) }}" "{{ end }}" > $1/templates/gloo-https.yaml
