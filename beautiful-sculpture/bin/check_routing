#!/bin/bash 
recordSets=$(aws route53 list-resource-record-sets --hosted-zone-id Z2895YZY6K7CA5)
host=qa1-app.tidepool.org
elb=$(identify_ambassador_loadbalancer.sh)
hosts=$(virtual_hosts.sh)
mismatch=false
for host in $hosts
do
   current=$(echo $recordSets | jq ".ResourceRecordSets[] | select(.Name==\"${host}.\") | .AliasTarget.DNSName" |sed  -e 's#\"##g' -e 's#\.$##' )
   if [ "$current" == "" ]
   then
	  echo "$host $host is NOT being routed."
	  mismatch=true
	  continue
   fi
   if [ "$current" != "$elb" ]
   then
	   echo "host $host is being routed by a different Ambassador load balancer."
	   mismatch=true
   fi
done

if [ "$mismatch" == "true" ]
then
    echo "current load balancer is NOT used with current virtual hosts"
else
    echo "current load balance IS used with current virtual hosts."
fi
