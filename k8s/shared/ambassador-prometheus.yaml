apiVersion: v1
kind: Service
metadata:
  name: ambassador-monitor
  labels:
    service: ambassador-monitor
spec:
  selector:
    app: statsd-exporter
  type: ClusterIP
  clusterIP: None
  ports:
  - name: prometheus-metrics
    port: 9102
    targetPort: 9102
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: ambassador-monitor
  labels:
    ambassador: monitoring
spec:
  endpoints:
  - path: /metrics
    port: prometheus-metrics
  namespaceSelector:
    matchNames:
    - default
  selector:
    matchLabels:
      service: ambassador-monitor
 ---
 apiVersion: monitoring.coreos.com/v1
 kind: Prometheus
 metadata:
   labels:
     app: ambassador-prometheus
   name: ambassador-prometheus
   namespace: default
 spec:
   alerting:
     alertmanagers:
     - name: default-prometheus-operato-alertmanager
       namespace: default
       pathPrefix: /
       port: web
   baseImage: quay.io/prometheus/prometheus
   logLevel: info
   retention: 10d
   routePrefix: /
   ruleNamespaceSelector: {}
   securityContext:
     fsGroup: 2000
     runAsNonRoot: true
     runAsUser: 1000
   serviceAccountName: default-prometheus-operato-prometheus
   serviceMonitorNamespaceSelector: {}
   serviceMonitorSelector:
     matchLabels:
       ambassador: monitoring
