{{ $cluster := .Values.global.cluster }}
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: {{ $cluster.name }}
  region: {{ $cluster.region }}
  version: {{ $cluster.k8sVersion | quote }}

vpc:
  cidr: {{ $cluster.cidr | quote }}

nodeGroups:
  - name: ng-1
    instanceType: {{ $cluster.nodegroup.instanceType }}
    desiredCapacity: {{ $cluster.nodegroup.desiredCapacity }}
    minSize: {{ $cluster.nodegroup.minSize }}
    maxSize: {{ $cluster.nodegroup.maxSize }}
    labels:
      kiam-server: "false"
    tags:
      k8s.io/cluster-autoscaler/enabled: "true"
      k8s.io/cluster-autoscaler/{{ $cluster.name }}: "true"
  - name: ng-kiam
    instanceType: {{ $cluster.nodegroup.instanceType }}
    desiredCapacity: 1
    labels: 
      kiam-server: "true"
    taints:
      kiam-server: "false:NoExecute"

