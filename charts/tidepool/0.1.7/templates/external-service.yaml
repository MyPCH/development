{{ if (or .Values.global.environment.hosts.http.enabled .Values.global.environment.hosts.https.enabled ) }}
---
apiVersion: v1
kind: Service
metadata:
  name: external-gateway-loadbalancer
{{ if .Values.global.gateway.annotations }}
  annotations:
    {{ .Values.global.gateway.annotations | toYaml | nindent 4 }}
{{ end }}
spec:
  externalTrafficPolicy: Local
  ports:
{{ if .Values.global.environment.hosts.https.enabled }}
  - name: https
    port: {{ .Values.global.environment.hosts.https.port | default 443  }}
    protocol: TCP
    targetPort: 8443
{{ end }}
{{ if .Values.global.environment.hosts.http.enabled }}
  - name: http
    port: {{ .Values.global.environment.hosts.http.port | default 80 }}
    protocol: TCP
    targetPort: 8080
{{ end }}
  selector:
    gloo: {{ .Values.global.gateway.proxy.name }}
  type: {{ .Values.global.gateway.type | default "LoadBalancer" }}
{{ end }}
