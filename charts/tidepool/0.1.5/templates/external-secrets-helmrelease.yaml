{{ if (or (eq .Values.global.secrets.external.source "awsSecretsManager") (eq .Values.global.secrets.internal.source "awsSecretsManager")) }}
apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: external-secrets
  namespace: {{ .Release.Namespace }}
spec:
  releaseName: external-secrets
  chart:
    git: git@github.com:godaddy/kubernetes-external-secrets
    path: charts/kubernetes-external-secrets
    ref: master
  values:
    podAnnotations:
      iam.amazonaws.com/role: {{ include "charts.externalSecrets.role" . }}
    env:
      POLLER_INTERVAL_MILLISECONDS: '300000'
{{ end }}
