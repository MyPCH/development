# Auto-generated file by gloo-gateway. Do not edit.
{{ if and (.Values.gloo.enabled) (.Values.https.enabled) }}
--- #file: api-external-VirtualService
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: '{{.Release.Namespace}}-api.tidepool.org'
  namespace: '{{- .Release.Namespace -}}'
spec:
  sslConfig:
    secretRef:
      name: tidepool-org
      namespace: default
    sniDomains:
    - '{{.Release.Namespace}}-api.tidepool.org'
  virtualHost:
    corsPolicy:
      allowCredentials: true
      allowHeaders:
      - authorization
      - content-type
      - x-tidepool-session-token
      - x-tidepool-trace-request
      - x-tidepool-trace-session
      allowMethods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - OPTIONS
      allowOriginRegex:
      - '*'
      exposeHeaders:
      - x-tidepool-session-token
      - x-tidepool-trace-request
      - x-tidepool-trace-session
      maxAge: 600s
    domains:
    - '{{.Release.Namespace}}-api.tidepool.org'
    name: '{{.Release.Namespace}}-api.tidepool.org'
    routes:
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/restricted_tokens
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/provider_sessions
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        - OPTIONS
        regex: /v1/users/[^/]+/data_sources
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        regex: /v1/provider_sessions/[^/]+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - DELETE
        regex: /v1/oauth/[^/]+/authorize
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        regex: /v1/users/[^/]+/data_sets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/images/.+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-image-9226'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        regex: /v1/oauth/[^/]+/redirect
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        regex: /v1/users/[^/]+/datasets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        regex: /v1/blobs/[^/]+/content
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-blob-9225'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        regex: /v1/data_sources/[^/]+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/images
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-image-9226'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        prefix: /v1/restricted_tokens
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/blobs
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-blob-9225'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - DELETE
        regex: /v1/users/[^/]+/data
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - DELETE
        regex: /v1/blobs/[^/]+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-blob-9225'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        regex: /v1/tasks/[^/*]
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-task-9224'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - DELETE
        regex: /v1/users/[^/*]
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-user-9221'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /dataservices/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /userservices/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-user-9221'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        prefix: /v1/data_sets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - POST
        - PUT
        - DELETE
        prefix: /v1/datasets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        prefix: /v1/images
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-image-9226'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /metadata/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-seagull-9120'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /metrics/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-highwater-9191'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /confirm/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-hydrophone-9157'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /message/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-message-api-9119'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /v1/data/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - POST
        prefix: /v1/tasks
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-task-9224'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /export/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-export-9300'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /access/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-gatekeeper-9123'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        prefix: /v1/time
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /auth/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-shoreline-9107'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /data/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-tide-whisperer-9127'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
--- #file: api-gateway-proxy-internal-Service
apiVersion: v1
kind: Service
metadata:
  name: '{{.Release.Namespace.}}-api.gateway-proxy.svc.cluster.local'
  namespace: '{{.Release.Namespace}}'
spec:
  externalName: gateway-proxy.gloo-system.svc.cluster.local
  ports:
  - port: 80
  type: ExternalName
--- #file: api-internal-VirtualService
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: '{{.Release.Namespace}}-api.svc.cluster.local'
  namespace: '{{- .Release.Namespace -}}'
spec:
  virtualHost:
    domains:
    - '{{.Release.Namespace}}-api.svc.cluster.local'
    name: '{{.Release.Namespace}}-api.svc.cluster.local'
    routes:
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/restricted_tokens
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/provider_sessions
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        - OPTIONS
        regex: /v1/users/[^/]+/data_sources
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        regex: /v1/provider_sessions/[^/]+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - DELETE
        regex: /v1/oauth/[^/]+/authorize
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        regex: /v1/users/[^/]+/data_sets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/images/.+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-image-9226'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        regex: /v1/oauth/[^/]+/redirect
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        regex: /v1/users/[^/]+/datasets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        regex: /v1/blobs/[^/]+/content
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-blob-9225'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        regex: /v1/data_sources/[^/]+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/images
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-image-9226'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        prefix: /v1/restricted_tokens
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-auth-9222'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - POST
        - DELETE
        regex: /v1/users/[^/]+/blobs
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-blob-9225'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - DELETE
        regex: /v1/users/[^/]+/data
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - DELETE
        regex: /v1/blobs/[^/]+
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-blob-9225'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        regex: /v1/tasks/[^/*]
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-task-9224'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - DELETE
        regex: /v1/users/[^/*]
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-user-9221'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /dataservices/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /userservices/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-user-9221'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        prefix: /v1/data_sets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - POST
        - PUT
        - DELETE
        prefix: /v1/datasets
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - PUT
        - DELETE
        prefix: /v1/images
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-image-9226'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /metadata/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-seagull-9120'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /metrics/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-highwater-9191'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /confirm/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-hydrophone-9157'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /message/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-message-api-9119'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /v1/data/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - POST
        prefix: /v1/tasks
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-task-9224'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /export/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-export-9300'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /access/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-gatekeeper-9123'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        prefix: /v1/time
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-platform-data-9220'
            namespace: '{{- .Release.Namespace -}}'
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /auth/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-shoreline-9107'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /data/
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-tide-whisperer-9127'
            namespace: '{{- .Release.Namespace -}}'
      routePlugins:
        prefixRewrite:
          prefixRewrite: /
--- #file: app-external-VirtualService
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: '{{.Release.Namespace}}-app.tidepool.org'
  namespace: '{{- .Release.Namespace -}}'
spec:
  sslConfig:
    secretRef:
      name: tidepool-org
      namespace: default
    sniDomains:
    - '{{.Release.Namespace}}-app.tidepool.org'
  virtualHost:
    corsPolicy:
      allowCredentials: true
      allowHeaders:
      - authorization
      - content-type
      - x-tidepool-session-token
      - x-tidepool-trace-request
      - x-tidepool-trace-session
      allowMethods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - OPTIONS
      allowOriginRegex:
      - '*'
      exposeHeaders:
      - x-tidepool-session-token
      - x-tidepool-trace-request
      - x-tidepool-trace-session
      maxAge: 600s
    domains:
    - '{{.Release.Namespace}}-app.tidepool.org'
    name: '{{.Release.Namespace}}-app.tidepool.org'
    routes:
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-blip-3000'
            namespace: '{{- .Release.Namespace -}}'
--- #file: app-gateway-proxy-internal-Service
apiVersion: v1
kind: Service
metadata:
  name: '{{.Release.Namespace.}}-app.gateway-proxy.svc.cluster.local'
  namespace: '{{.Release.Namespace}}'
spec:
  externalName: gateway-proxy.gloo-system.svc.cluster.local
  ports:
  - port: 80
  type: ExternalName
--- #file: app-internal-VirtualService
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: '{{.Release.Namespace}}-app.svc.cluster.local'
  namespace: '{{- .Release.Namespace -}}'
spec:
  virtualHost:
    domains:
    - '{{.Release.Namespace}}-app.svc.cluster.local'
    name: '{{.Release.Namespace}}-app.svc.cluster.local'
    routes:
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-blip-3000'
            namespace: '{{- .Release.Namespace -}}'
--- #file: blip-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-blip-3000'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: blip
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 3000
--- #file: export-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-export-9300'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: export
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9300
--- #file: gatekeeper-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-gatekeeper-9123'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: gatekeeper
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9123
--- #file: gateway-Gateway
apiVersion: gateway.solo.io/v1
bindAddress: '::'
bindPort: 8080
kind: Gateway
metadata:
  name: gateway
  namespace: gloo-system
ssl: false
useProxyProto: false
--- #file: gateway-proxy-Service
apiVersion: v1
kind: Service
metadata:
  labels:
    app: gloo
    gloo: gateway-proxy
  name: gateway-proxy-ssl
  namespace: gloo-system
spec:
  externalTrafficPolicy: Cluster
  ports:
  - name: https
    port: 443
    protocol: TCP
    targetPort: 8443
  selector:
    gloo: gateway-proxy
  type: LoadBalancer
--- #file: gateway-proxy-internal-Service
apiVersion: v1
kind: Service
metadata:
  labels:
    app: gloo
    gloo: gateway-proxy
  name: gateway-proxy
  namespace: gloo-system
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 8080
  selector:
    gloo: gateway-proxy
  type: ClusterIP
--- #file: gateway-ssl-Gateway
apiVersion: gateway.solo.io/v1
bindAddress: '::'
bindPort: 8443
kind: Gateway
metadata:
  name: gateway-ssl
  namespace: gloo-system
ssl: true
useProxyProto: false
--- #file: highwater-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-highwater-9191'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: highwater
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9191
--- #file: hydrophone-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-hydrophone-9157'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: hydrophone
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9157
--- #file: jellyfish-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-jellyfish-9122'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: jellyfish
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9122
--- #file: message-api-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-message-api-9119'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: message-api
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9119
--- #file: platform-auth-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-platform-auth-9222'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: platform-auth
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9222
--- #file: platform-blob-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-platform-blob-9225'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: platform-blob
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9225
--- #file: platform-data-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-platform-data-9220'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: platform-data
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9220
--- #file: platform-image-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-platform-image-9226'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: platform-image
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9226
--- #file: platform-task-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-platform-task-9224'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: platform-task
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9224
--- #file: platform-user-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-platform-user-9221'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: platform-user
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9221
--- #file: seagull-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-seagull-9120'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: seagull
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9120
--- #file: shoreline-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-shoreline-9107'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: shoreline
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9107
--- #file: tide-whisperer-Upstream
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: '{{- .Release.Namespace -}}-tide-whisperer-9127'
  namespace: '{{- .Release.Namespace -}}'
spec:
  kube:
    serviceName: tide-whisperer
    serviceNamespace: '{{.Release.Namespace}}'
    servicePort: 9127
--- #file: uploads-external-VirtualService
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: '{{.Release.Namespace}}-uploads.tidepool.org'
  namespace: '{{- .Release.Namespace -}}'
spec:
  sslConfig:
    secretRef:
      name: tidepool-org
      namespace: default
    sniDomains:
    - '{{.Release.Namespace}}-uploads.tidepool.org'
  virtualHost:
    corsPolicy:
      allowCredentials: true
      allowHeaders:
      - authorization
      - content-type
      - x-tidepool-session-token
      - x-tidepool-trace-request
      - x-tidepool-trace-session
      allowMethods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - OPTIONS
      allowOriginRegex:
      - '*'
      exposeHeaders:
      - x-tidepool-session-token
      - x-tidepool-trace-request
      - x-tidepool-trace-session
      maxAge: 600s
    domains:
    - '{{.Release.Namespace}}-uploads.tidepool.org'
    name: '{{.Release.Namespace}}-uploads.tidepool.org'
    routes:
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-jellyfish-9122'
            namespace: '{{- .Release.Namespace -}}'
--- #file: uploads-gateway-proxy-internal-Service
apiVersion: v1
kind: Service
metadata:
  name: '{{.Release.Namespace.}}-uploads.gateway-proxy.svc.cluster.local'
  namespace: '{{.Release.Namespace}}'
spec:
  externalName: gateway-proxy.gloo-system.svc.cluster.local
  ports:
  - port: 80
  type: ExternalName
--- #file: uploads-internal-VirtualService
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: '{{.Release.Namespace}}-uploads.svc.cluster.local'
  namespace: '{{- .Release.Namespace -}}'
spec:
  virtualHost:
    domains:
    - '{{.Release.Namespace}}-uploads.svc.cluster.local'
    name: '{{.Release.Namespace}}-uploads.svc.cluster.local'
    routes:
    - matcher:
        methods:
        - GET
        - OPTIONS
        - POST
        - PUT
        - PATCH
        - DELETE
        prefix: /
      routeAction:
        single:
          upstream:
            name: '{{- .Release.Namespace -}}-jellyfish-9122'
            namespace: '{{- .Release.Namespace -}}'
{{ end }}
