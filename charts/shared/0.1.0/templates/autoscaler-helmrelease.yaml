{{ if .Values.autoscaler.helmrelease.create }}
---
apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: autoscaler
  namespace: {{ .Values.autoscaler.namespace.name }}
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: autoscaler
  chart:
    {{- .Values.autoscaler.helmrelease.chart | toYaml | nindent 4 }}
  values: 
    rbac:
      create: true
    autoDiscovery:
      cluster.eks.name: {{ .Values.cluster.eks.name | quote }}
    awsRegion: {{ .Values.cluster.eks.region | quote }}
    serviceMonitor:
      helmrelease.create: true
    sslCertHostPath: /etc/ssl/certs/ca-bundle.crt
    extraArgs:
      v: 4
      stderrthreshold: info
      logtostderr: true
      skip-nodes-with-local-storage: false
    podAnnotations:
      iam.amazonaws.com/role: {{ include "charts.autoscaler.role" . }}
{{ end }}
