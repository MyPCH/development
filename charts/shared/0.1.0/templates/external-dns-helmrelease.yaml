{{ if .Values.externalDNS.helmrelease.create }}
---
apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: external-dns
  namespace: {{ .Values.externalDNS.namespace.name }}
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: external-dns
  chart:
    {{- .Values.externalDNS.helmrelease.chart | toYaml | nindent 4 }}
  values:
    podAnnotations:
      iam.amazonaws.com/role: {{ include "charts.externalDNS.role" . }}
    domainfilter: {{ .Values.externalDNS.deployment.env.domainfilter | quote }}
    image:
      name: {{ .Values.externalDNS.deployment.image | quote }}
      pullSecrets: {}
    tag: {{ .Values.externalDNS.deployment.tag | quote }}
    ownerid: external-dns 
    rbac:
      create: true
    logLevel: {{ .Values.cluster.logLevel | quote }}
    provider: aws
    awszonetype: public 
    aws:
      region: {{ .Values.cluster.eks.region | quote }}
    txtOwnerId: {{ .Values.cluster.eks.name | quote }}
{{ end }}
