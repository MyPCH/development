#!/bin/bash 
#
# Create Manifests from input directory.
# Use defaults in defaults directory.

export JSONNET_PATH=$(realpath .):$(realpath ./lib):$(realpath ./cf):$(realpath ./k8s)

ARGS=$(jsonnet_path)

for x in k8s/kubernetes cf/cf eksctl/eksctl
do
  if [ $# == 1 ]
  then
      combined=$(combine $1 "default")
  else
      combined=$(combine default)
  fi
  
  jsonnet $ARGS --tla-code config="$combined" $x.jsonnet | yq read - >$x.yaml
done
